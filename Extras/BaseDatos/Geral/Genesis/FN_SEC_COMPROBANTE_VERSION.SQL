CREATE OR REPLACE FUNCTION FN_SEC_COMPROBANTE_###VERSION### (IDENTIFICADOR_SECTOR IN VARCHAR2, IDENTIFICADOR_FORMULARIO IN VARCHAR2) 
  RETURN NUMBER 
IS
  PRAGMA AUTONOMOUS_TRANSACTION;
  RESULT NUMBER(10);
BEGIN
  /*Version: ###VERSION_COMP###*/

     MERGE INTO SAPR_TSECUENCIA_COMPROBANTE Q1
          USING (SELECT IDENTIFICADOR_SECTOR OID_SECTOR, IDENTIFICADOR_FORMULARIO OID_FORMULARIO FROM DUAL) Q2 ON (Q1.OID_SECTOR = Q2.OID_SECTOR AND Q1.OID_FORMULARIO = Q2.OID_FORMULARIO)
     WHEN MATCHED THEN
          UPDATE
                  SET Q1.NEL_SECUENCIA  = (Q1.NEL_SECUENCIA + 1)
     WHEN NOT MATCHED THEN
          INSERT (Q1.OID_SECUENCIA_COMPROBANTE
                 ,Q1.OID_SECTOR
                 ,Q1.OID_FORMULARIO
                 ,Q1.NEL_SECUENCIA)
          VALUES (SYS_GUID()
                 ,Q2.OID_SECTOR
                 ,Q2.OID_FORMULARIO
                 ,1);

     SELECT SC.NEL_SECUENCIA INTO RESULT FROM SAPR_TSECUENCIA_COMPROBANTE SC WHERE SC.OID_SECTOR = IDENTIFICADOR_SECTOR AND SC.OID_FORMULARIO = IDENTIFICADOR_FORMULARIO;

     COMMIT;

     RETURN(RESULT);

EXCEPTION
     WHEN OTHERS THEN
          ROLLBACK;
          RAISE;

END FN_SEC_COMPROBANTE_###VERSION###;
/
