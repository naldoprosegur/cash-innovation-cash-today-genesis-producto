CREATE OR REPLACE PROCEDURE SP_BORRAR_CERTIFICADO_###VERSION###(P_OID_CERTIFICADO IN VARCHAR2)
AS
  /*Version: ###VERSION_COMP###*/
V_COD_ESTADO VARCHAR2(50);
V_EXISTE NUMBER;

BEGIN

SELECT COUNT(*) INTO V_EXISTE FROM SAPR_TCERTIFICADO C WHERE C.OID_CERTIFICADO = P_OID_CERTIFICADO;

IF V_EXISTE > 0 THEN
  
  SELECT COD_ESTADO INTO V_COD_ESTADO 
  FROM SAPR_TCERTIFICADO C WHERE C.OID_CERTIFICADO = P_OID_CERTIFICADO;
  
  IF V_COD_ESTADO <> 'DE' THEN
      
    DELETE SAPR_TCERT_SALDO_EFECTIVO SE WHERE SE.OID_CERTIFICADO = P_OID_CERTIFICADO;
    DELETE SAPR_TCERT_SALDO_MEDIO_PAGO SMP WHERE SMP.OID_CERTIFICADO = P_OID_CERTIFICADO;

    DELETE SAPR_TCERTIFICADOXDELEGACION CD WHERE CD.OID_CERTIFICADO = P_OID_CERTIFICADO;
    DELETE SAPR_TCERTIFICADOXSECTOR CE WHERE CE.OID_CERTIFICADO = P_OID_CERTIFICADO;
    DELETE SAPR_TCERTIFICADOXSUBCANAL CSB WHERE CSB.OID_CERTIFICADO = P_OID_CERTIFICADO;

    UPDATE SAPR_TTRANSACCION_EFECTIVO TE
    SET
    TE.OID_CERTIFICADO = NULL
    WHERE TE.OID_CERTIFICADO = P_OID_CERTIFICADO;

    UPDATE SAPR_TTRANSACCION_MEDIO_PAGO TMP
    SET
    TMP.OID_CERTIFICADO = NULL
    WHERE TMP.OID_CERTIFICADO = P_OID_CERTIFICADO;

    DELETE SAPR_TCERTIFICADO CE WHERE CE.OID_CERTIFICADO = P_OID_CERTIFICADO;

  END IF;
  
END IF;

END SP_BORRAR_CERTIFICADO_###VERSION###;
/
